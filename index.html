<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mister Jon Sukses — Latihan Mengetik</title>
  <style>
    :root{
      --text:#e6eef8;
      --muted:#9aa7bd;
      --accent:#a78bfa;
      --accent-2:#60a5fa;
      --panel: rgba(255,255,255,0.03);
      --success:#34d399;
      --danger:#ef4444;
      --bg-dark:#070816;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    html,body{height:100%;margin:0;}
    body{
      margin:0;padding:0;min-height:100vh;color:var(--text);overflow:hidden;
      display:flex;align-items:center;justify-content:center;background:var(--bg-dark);
    }

    /* soft animated gradient (gelap elegan) */
    body::before{
      content:"";position:fixed;inset:0;
      background:linear-gradient(120deg,#07102b 0%, #11112a 30%, #1a1340 60%, #2b1050 100%);
      background-size:400% 400%;z-index:-3;
      animation:gradMove 18s ease infinite; filter:saturate(1.02) brightness(0.95);
    }
    @keyframes gradMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    /* Particles (soft bokeh) */
    #particles{position:fixed;inset:0;z-index:-2;pointer-events:none;overflow:hidden}

    .wrap{
      width:1000px;max-width:96%;margin:28px auto;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:26px;border-radius:14px;box-shadow:0 8px 40px rgba(2,6,23,0.6);position:relative;backdrop-filter: blur(6px);
    }

    header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    h1{margin:0;color:var(--accent);font-size:1.25rem;display:flex;align-items:center;gap:10px}
    .controls{display:flex;gap:10px;align-items:center}

    input[type="text"]{
      background:transparent;border:none;border-bottom:1px solid rgba(255,255,255,0.06);
      color:var(--text);padding:8px 10px;font-size:0.98rem;width:210px;outline:none;
    }

    #layout{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:16px;}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:10px;}

    #wordArea{
      font-size:1.9rem;margin:12px 0;padding:18px;border-radius:12px;background:rgba(255,255,255,0.02);display:inline-block;line-height:1.6;color:var(--text);
      max-width:100%;
      user-select:none;
    }
    #wordArea span{padding:0 6px;border-radius:6px;transition:all .12s ease; display:inline-block}
    #wordArea span.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#020617;padding:0 8px}
    #wordArea span.error{color:var(--danger); text-decoration:underline; opacity:0.95;}
    #wordArea span.correct{color:var(--success); font-weight:600; opacity:0.98;}

    #input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);margin-top:8px;background:transparent;color:var(--text);font-size:1rem}
    #input:disabled{opacity:0.6}

    .meta{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .badge{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:8px;font-size:0.95rem;color:var(--muted)}

    button{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;padding:10px 14px;border-radius:8px;color:#071022;font-weight:700;cursor:pointer;}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text);font-weight:600}
    small{color:var(--muted);display:block;margin-top:8px}

    .side{display:flex;flex-direction:column;gap:12px}
    .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;min-height:64px}
    #chart{width:100%;height:160px;background:transparent;border-radius:8px;display:block}

    .achievement{display:inline-block;padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,#ffd166,#f0a500);color:#061021;font-weight:700;margin-right:6px}

    #confettiCanvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:60}

    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:0.85rem}
    @media(max-width:960px){.wrap{padding:16px}#layout{grid-template-columns:1fr}.side{order:2}h1{font-size:1.05rem}#wordArea{font-size:1.6rem}}
    @media(max-width:420px){#wordArea{font-size:1.15rem;padding:12px}input[type="text"]{width:140px}#chart{height:110px}}
  </style>
</head>
<body>
  <div id="particles" aria-hidden="true"></div>

  <div class="wrap" role="main">
    <header>
      <h1>⭐ Mister Jon Sukses — Latihan Mengetik</h1>
      <div class="controls">
        <input id="nameInput" type="text" placeholder="Nama (opsional)" />
        <div class="badge">Durasi:
          <select id="durationSelect" style="background:transparent;border:none;color:var(--text);outline:none">
            <option value="30">30s</option>
            <option value="60" selected>60s</option>
            <option value="120">120s</option>
          </select>
        </div>
        <button id="start">Mulai</button>
        <button id="reset" class="secondary">Ulangi</button>
      </div>
    </header>

    <div id="layout">
      <div class="panel">
        <div id="wordArea" aria-live="polite"></div>
        <input id="input" type="text" placeholder="Ketik di sini..." disabled autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false"/>

        <div class="meta">
          <div class="badge">Waktu: <span id="timer">60 detik</span></div>
          <div class="badge">WPM: <span id="wpm">0</span></div>
          <div class="badge">Akurasi: <span id="acc">0%</span></div>
          <div class="badge">Terbaik: <span id="best">0</span> WPM</div>
        </div>

        <div id="motivation" style="margin-top:12px;color:var(--accent);font-style:italic">✨ Sukses dimulai dari satu huruf pertama.</div>
        <div style="margin-top:12px"><small class="small-muted">Tip: tekan <strong>Space</strong> atau <strong>Enter</strong> untuk lanjut ke kata berikutnya — jika salah tetap akan lanjut, kata yang salah diberi warna merah.</small></div>
      </div>

      <div class="side">
        <div class="card">
          <div class="small-muted">Grafik Progres WPM</div>
          <canvas id="chart" aria-hidden="true"></canvas>
        </div>

        <div class="card">
          <div class="small-muted">Lencana Pencapaian</div>
          <div id="achievements" style="margin-top:8px"></div>
        </div>

        <div class="card">
          <div class="small-muted">Quote Motivasi (Indonesia)</div>
          <div id="quote" style="margin-top:8px;font-weight:700"></div>
        </div>
      </div>
    </div>

    <footer>© 2025 Mister Jon Sukses — Semangat latihan!</footer>
  </div>

  <canvas id="confettiCanvas" aria-hidden="true"></canvas>

  <script>
  /* ------------- Particles (soft bokeh) ------------- */
  (function initParticles(){
    const container = document.getElementById('particles');
    const total = 30;
    for(let i=0;i<total;i++){
      const p = document.createElement('div');
      const size = 6 + Math.random()*22;
      p.style.width = p.style.height = size + 'px';
      p.style.left = (Math.random()*100) + '%';
      p.style.top = (Math.random()*100) + '%';
      p.style.position = 'absolute';
      p.style.background = 'rgba(255,255,255,' + (0.03 + Math.random()*0.12) + ')';
      p.style.filter = 'blur(' + (1 + Math.random()*6) + 'px)';
      p.style.borderRadius = '50%';
      p.style.pointerEvents = 'none';
      container.appendChild(p);
      const dur = 18 + Math.random()*28;
      p.animate(
        [{ transform:'translateY(0)', opacity:0 }, { transform:'translateY(-120vh)', opacity:0.9 }],
        { duration: dur*1000, iterations: Infinity, delay: (Math.random()*-dur*1000), easing: 'linear' }
      );
    }
  })();

  /* ------------- Audio (soft) ------------- */
  const audioCtx = (window.AudioContext || window.webkitAudioContext) ? new (window.AudioContext || window.webkitAudioContext)() : null;
  function playTone(freq=440, type='sine', duration=0.12, gain=0.04){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq; g.gain.value = gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    setTimeout(()=>{ try{o.stop()}catch(e){} }, duration*1000+50);
  }
  function soundCorrect(){ playTone(880,'sine',0.09,0.03); playTone(1320,'sine',0.05,0.02); }
  function soundWrong(){ playTone(220,'sawtooth',0.10,0.05); }
  function soundFinish(){ playTone(880,'sine',0.12,0.05); playTone(660,'triangle',0.14,0.03); }

  /* ------------- Core typing logic ------------- */
  let words = [
    "aku","kamu","kita","sukses","cepat","fokus","hebat","menang","percaya",
    "berani","latihan","mister","jon","semangat","usaha","tujuan","nyata",
    "disiplin","terus","maju","pantang","menyerah","jari","kuat","kreatif"
  ];

  const quotes = [
    "Jangan takut mulai — setiap ketikan membawa perubahan.",
    "Disiplin kecil setiap hari menghasilkan hasil besar.",
    "Kecepatan tumbuh dari latihan yang konsisten.",
    "Fokus hari ini, hasil esok akan terlihat.",
    "Kegigihan melewati rintangan membentuk juara.",
    "Satu kata lagi, satu langkah lebih dekat.",
    "Latihan hari ini menentukan kemampuan besok.",
    "Buat setiap ketikan berarti — itu namanya progres.",
    "Jangan bandingkan, cukup kalahkan skor kemarin.",
    "Kerja kecil yang terus diulang adalah kemenangan besar."
  ];

  const input = document.getElementById("input");
  const wordArea = document.getElementById("wordArea");
  const timerEl = document.getElementById("timer");
  const wpmEl = document.getElementById("wpm");
  const accEl = document.getElementById("acc");
  const bestEl = document.getElementById("best");
  const startBtn = document.getElementById("start");
  const resetBtn = document.getElementById("reset");
  const durationSelect = document.getElementById("durationSelect");
  const nameInput = document.getElementById("nameInput");
  const motivationEl = document.getElementById("motivation") || document.createElement('div');
  const quoteEl = document.getElementById("quote");
  const achievementsEl = document.getElementById("achievements");

  let duration = parseInt(durationSelect.value,10);
  durationSelect.addEventListener('change', ()=>{ duration = parseInt(durationSelect.value,10); updateTimerDisplay(duration); });

  function shuffle(arr){ let a = arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

  // state
  let timeLeft = duration, interval=null, motTimer=null;
  let started=false, startTime=0, currentIndex=0;
  let correctChars=0, totalChars=0;
  let bestScore = Number(localStorage.getItem('bestWPM') || 0);
  bestEl.textContent = bestScore;

  // chart history stored in localStorage as array of numbers or objects
  let history = JSON.parse(localStorage.getItem('mj_history') || '[]');

  // render random quote
  function showRandomQuote(){ const q = quotes[Math.floor(Math.random()*quotes.length)]; quoteEl.textContent = q; }
  showRandomQuote();

  // render words
  function renderWords(){
    wordArea.innerHTML = words.map((w,i)=>`<span class="${i===0?'active':''}" data-word="${w}">${w}</span>`).join(" ");
  }
  renderWords();

  function updateTimerDisplay(t){ timerEl.textContent = `${t} detik`; }
  updateTimerDisplay(duration);

  function startSession(){
    if(started) return;
    if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

    started = true;
    duration = parseInt(durationSelect.value,10);
    timeLeft = duration;
    updateTimerDisplay(timeLeft);

    words = shuffle(words);
    renderWords();
    input.disabled = false;
    input.focus();
    currentIndex = 0;
    correctChars = 0;
    totalChars = 0;
    startTime = Date.now();
    nameInput.blur();

    motTimer = setInterval(()=>{
      if(motivationEl) motivationEl.textContent = quotes[Math.floor(Math.random()*quotes.length)];
    }, 3500);

    interval = setInterval(()=>{
      timeLeft--;
      updateTimerDisplay(timeLeft);
      if(timeLeft <= 0) endSession();
      const elapsedMin = (Date.now() - startTime)/60000;
      const wpmLive = elapsedMin > 0 ? Math.round((correctChars/5)/elapsedMin) : 0;
      wpmEl.textContent = wpmLive;
    }, 1000);
  }

  function evaluateAndAdvance(submitWord){
    // Evaluate word correctness and advance even if wrong (auto-continue)
    const spans = wordArea.querySelectorAll("span");
    const currentSpan = spans[currentIndex];
    const currentWord = words[currentIndex];

    // count totals as chars of currentWord
    totalChars += currentWord.length;

    if(submitWord === currentWord){
      // fully correct
      correctChars += currentWord.length;
      currentSpan.classList.remove('error');
      currentSpan.classList.add('correct');
      soundCorrect();
    } else {
      // wrong — mark error, but still continue
      currentSpan.classList.add('error');
      currentSpan.classList.remove('correct');
      soundWrong();
    }

    // move to next
    currentSpan.classList.remove('active');
    currentIndex++;
    if(currentIndex >= words.length) {
      // reshuffle and reset index if reached end
      words = shuffle(words);
      currentIndex = 0;
    }
    renderWords();
    const nextSpans = wordArea.querySelectorAll("span");
    if(nextSpans[currentIndex]) nextSpans[currentIndex].classList.add('active');
  }

  function endSession(){
    clearInterval(interval);
    clearInterval(motTimer);
    input.disabled = true;
    started = false;
    const elapsedMin = Math.max((Date.now() - startTime)/60000, 1/60000);
    const wpm = Math.round((correctChars/5)/elapsedMin);
    const acc = totalChars > 0 ? Math.round((correctChars/totalChars)*100) : 100;
    wpmEl.textContent = wpm;
    accEl.textContent = acc + '%';
    motivationEl.textContent = `✨ Hebat ${nameInput.value.trim() || 'Pemain'}! Skormu: ${wpm} WPM`;

    // add to history and persist (store just numbers for simplicity)
    history.push(typeof wpm === 'number' ? wpm : Number(wpm));
    if(history.length>40) history.shift(); // cap
    localStorage.setItem('mj_history', JSON.stringify(history));

    // update best
    if(wpm > bestScore){ bestScore = wpm; localStorage.setItem('bestWPM', bestScore); bestEl.textContent = bestScore; }

    // show badge
    showBadgeForWPM(wpm);

    // confetti + sound finish
    runConfetti();
    soundFinish();

    // update chart
    animateChartUpdate();

    // new quote
    showRandomQuote();
  }

  function resetSession(){
    clearInterval(interval);
    clearInterval(motTimer);
    input.value = "";
    input.disabled = true;
    started = false;
    timeLeft = parseInt(durationSelect.value,10);
    updateTimerDisplay(timeLeft);
    if(motivationEl) motivationEl.textContent = "✨ Siap mengetik lagi?";
    wpmEl.textContent = '0'; accEl.textContent = '0%';
    words = shuffle(words);
    renderWords();
  }

  // Input behavior:
  // - While typing, mark prefix errors red but do NOT block.
  // - On Space or Enter OR when typed === currentWord, submit and auto-advance.
  input.addEventListener('input', ()=>{
    if(!started) return;
    const spans = wordArea.querySelectorAll("span");
    const currentWord = words[currentIndex];
    const typedRaw = input.value;
    // for prefix check ignore internal spaces
    const typed = typedRaw.replace(/\s+/g,'');
    const currentSpan = spans[currentIndex];

    if(!currentWord.startsWith(typed)){
      currentSpan.classList.add('error');
      currentSpan.classList.remove('correct');
    } else {
      currentSpan.classList.remove('error');
    }

    // auto-submit if user typed full word exactly (without pressing space)
    if(typed === currentWord){
      evaluateAndAdvance(typed);
      input.value = "";
    }
  });

  // handle Space / Enter to submit and continue (even if wrong)
  // FIX: only advance if there is typed text (prevent skipping empty)
  input.addEventListener('keydown', (e)=>{
    if(!started) return;
    if(e.key === ' ' || e.key === 'Enter'){
      e.preventDefault();
      const submit = input.value.trim();
      if(submit.length === 0){
        // nothing typed: do not auto-advance (prevent accidental skips)
        // optional: flash or play a soft 'wrong' sound to indicate need to type
        // soundWrong(); // uncomment if you want audio feedback
        return;
      }
      evaluateAndAdvance(submit);
      input.value = "";
    }
  });

  // small wrong sound throttle (kept if you want to call)
  let wrongThrottle = 0;
  function soundWrongThrottled(){
    const now = Date.now();
    if(now - wrongThrottle > 260){ soundWrong(); wrongThrottle = now; }
  }

  function showBadgeForWPM(wpm){
    achievementsEl.innerHTML = '';
    const badges = [];
    if(wpm > 80) badges.push('Fokus Master');
    if(wpm > 60) badges.push('Cepat Banget');
    if(wpm > 40) badges.push('Maju Pesat');
    if(wpm > 20) badges.push('Pemula Hebat');
    if(badges.length === 0) badges.push('Terus Berlatih');

    badges.slice(0,3).forEach(b=>{
      const el = document.createElement('span');
      el.className = 'achievement';
      el.textContent = b;
      achievementsEl.appendChild(el);
    });
  }

  startBtn.addEventListener('click', startSession);
  resetBtn.addEventListener('click', resetSession);
  nameInput.addEventListener('blur', ()=>{ localStorage.setItem('mj_name', nameInput.value.trim()); });
  nameInput.value = localStorage.getItem('mj_name') || '';

  // keyboard shortcut: Space to start when not typing
  window.addEventListener('keydown', (e)=>{
    if(e.code === 'Space' && document.activeElement !== input){ e.preventDefault(); startSession(); }
  });

  // unlock audio on first user gesture
  document.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state === 'suspended'){ audioCtx.resume(); } }, {once:true});

  /* ------------- Confetti ------------- */
  const confettiCanvas = document.getElementById('confettiCanvas');
  const confettiCtx = confettiCanvas.getContext('2d');
  let confettiParticles = [];
  function resizeConfetti(){ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
  window.addEventListener('resize', resizeConfetti); resizeConfetti();

  function runConfetti(){
    confettiParticles = [];
    const count = 100;
    for(let i=0;i<count;i++){
      confettiParticles.push({
        x: window.innerWidth/2 + (Math.random()-0.5)*500,
        y: window.innerHeight/2 + (Math.random()-0.5)*120,
        vx: (Math.random()-0.5)*8,
        vy: -6 - Math.random()*6,
        size: 6 + Math.random()*8,
        color: `hsl(${200 + Math.random()*50},60%,${40 + Math.random()*20}%)`,
        rot: Math.random()*360, vr: (Math.random()-0.5)*10, life: 80 + Math.random()*60
      });
    }
    let frames = 0;
    const anim = setInterval(()=>{
      frames++;
      confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      confettiParticles.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.vy += 0.25; p.rot += p.vr; p.life--;
        confettiCtx.save();
        confettiCtx.translate(p.x,p.y);
        confettiCtx.rotate(p.rot * Math.PI/180);
        confettiCtx.fillStyle = p.color;
        confettiCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
        confettiCtx.restore();
      });
      confettiParticles = confettiParticles.filter(p=>p.life>0 && p.y < window.innerHeight+200);
      if(frames>140 || confettiParticles.length===0){ clearInterval(anim); confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
    }, 1000/60);
  }

  /* ------------- Chart (animated line) ------------- */
  const chartCanvas = document.getElementById('chart');
  const chartCtx = chartCanvas.getContext('2d');
  function resizeChart(){ chartCanvas.width = chartCanvas.clientWidth; chartCanvas.height = chartCanvas.clientHeight; }
  window.addEventListener('resize', resizeChart); resizeChart();

  function drawChart(progress=1){
    resizeChart();
    const data = Array.isArray(history) ? history.map(h => typeof h === 'number' ? h : (h.wpm || 0)) : [];
    chartCtx.clearRect(0,0,chartCanvas.width,chartCanvas.height);
    if(data.length === 0){
      chartCtx.fillStyle = 'rgba(255,255,255,0.02)';
      chartCtx.fillRect(0,0,chartCanvas.width,chartCanvas.height);
      chartCtx.fillStyle = 'rgba(255,255,255,0.6)';
      chartCtx.font = '13px Inter, sans-serif';
      chartCtx.fillText('Belum ada data latihan. Selesaikan satu sesi untuk melihat grafik.', 12, 24);
      return;
    }
    const pad = 14;
    const w = chartCanvas.width - pad*2;
    const h = chartCanvas.height - pad*2;
    const max = Math.max(...data, 10);
    const min = Math.min(...data, 0);
    chartCtx.strokeStyle = 'rgba(255,255,255,0.06)'; chartCtx.lineWidth = 1;
    for(let i=0;i<3;i++){
      const y = pad + i*(h/2);
      chartCtx.beginPath(); chartCtx.moveTo(pad,y); chartCtx.lineTo(pad+w,y); chartCtx.stroke();
    }
    chartCtx.beginPath();
    data.forEach((v,i)=>{
      const t = i / Math.max(1, data.length - 1);
      const x = pad + t * w;
      let val = v;
      if(i === data.length - 1) val = min + (v - min) * progress;
      const y = pad + h - ((val - min) / (max - min || 1)) * h;
      if(i===0) chartCtx.moveTo(x,y); else chartCtx.lineTo(x,y);
    });
    chartCtx.strokeStyle = 'rgba(167,139,250,0.95)'; chartCtx.lineWidth = 2.5; chartCtx.stroke();
    data.forEach((v,i)=>{
      const t = i / Math.max(1, data.length - 1);
      const x = pad + t * w;
      const y = pad + h - ((v - min) / (max - min || 1)) * h;
      chartCtx.beginPath(); chartCtx.fillStyle = 'rgba(255,255,255,0.95)'; chartCtx.arc(x,y,3,0,Math.PI*2); chartCtx.fill();
    });
    chartCtx.fillStyle = 'rgba(255,255,255,0.85)'; chartCtx.font = '12px Inter, sans-serif';
    chartCtx.fillText('Terakhir: ' + data.slice(-1)[0] + ' WPM', pad, 12);
  }

  let chartAnimId = null;
  function animateChartUpdate(){
    let prog = 0; const step = 0.06;
    if(chartAnimId) cancelAnimationFrame(chartAnimId);
    function stepAnim(){
      prog += step; drawChart(Math.min(prog,1));
      if(prog < 1) chartAnimId = requestAnimationFrame(stepAnim);
      else chartAnimId = null;
    }
    stepAnim();
  }
  drawChart();

  function showInitialBadge(){
    achievementsEl.innerHTML = '';
    if(bestScore > 0) {
      const el = document.createElement('span');
      el.className = 'achievement';
      el.textContent = 'Terbaik: ' + bestScore + ' WPM';
      achievementsEl.appendChild(el);
    } else {
      achievementsEl.textContent = 'Mulai latihan untuk dapat lencana!';
    }
  }
  showInitialBadge();

  // periodically redraw chart
  setInterval(()=>{ drawChart(1); }, 2500);
  </script>
</body>
</html>
